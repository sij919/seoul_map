<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>서울시 행정구역 지도</title>
    <style>
        html,
        body {
            height: 100%;
            overflow-y: hidden;
        }

        #container {
            width: 100%;
            height: 100%;
            margin: 0 auto;
        }
    </style>

    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR&display=swap" rel="stylesheet">
    <link href="https://netdna.bootstrapcdn.com/font-awesome/3.2.1/css/font-awesome.css" rel="stylesheet">

    <script src="https://code.highcharts.com/maps/highmaps.js"></script>
    <script src="https://code.highcharts.com/maps/modules/data.js"></script>
    <script src="https://code.highcharts.com/maps/modules/drilldown.js"></script>
    <script src="https://code.highcharts.com/maps/modules/exporting.js"></script>
    <script src="https://code.highcharts.com/maps/modules/offline-exporting.js"></script>
    <script src="https://code.highcharts.com/maps/modules/accessibility.js"></script>
</head>

<body>
    <div id="container"></div>
</body>

<script type="text/javascript">
    const drilldown = async function (e) {
        if (!e.seriesOptions) {
            const chart = this,
                mapKey = `${e.point.drilldown}`;

            // Show the Font Awesome spinner
            chart.showLoading('<i class="icon-spinner icon-spin icon-3x"></i>');

            // Load the drilldown map
            const topology = await fetch(
                `https://raw.githubusercontent.com/sij919/sgis/highchart_detail_map/seoul_dong/${mapKey}.geojson`
            ).then(response => response.json());

            const data = Highcharts.geojson(topology);

            // Set a non-random bogus value
            data.forEach((d, i) => {
                d.value = i; // random data
                d.name = d.properties.adm_nm.split(" ")[2];
            });

            // Hide loading and add series
            chart.hideLoading();
            chart.addSeriesAsDrilldown(e.point, {
                name: e.point.name,
                data,
                dataLabels: {
                    enabled: true,
                    format: '{point.name}',
                    backgroundColor: 'rgba(255,255,255,0.7)',
                    borderRadius: 5,
                    padding: 3,
                    color: 'black',
                    style: {
                        textOutline: 'none',
                        fontSize: '1.2em'
                    }
                },
            });
        }
    };

    (async () => {

        const topology = await fetch(
            'https://raw.githubusercontent.com/sij919/sgis/highchart_detail_map/seoul.geojson'
        ).then(response => response.json());

        const data = Highcharts.geojson(topology);

        // Set drilldown pointers
        data.forEach((d, i) => {
            d.drilldown = d.properties['adm_cd'];
            d.value = i; // Non-random bogus data
        });

        // Instantiate the map
        Highcharts.mapChart('container', {
            chart: {
                style: {
                    fontFamily: "'Noto Sans KR', sans-serif"
                },
                events: {
                    drilldown
                }
            },

            title: {
                text: '서울시 행정구역 지도',
                style: {
                    fontSize: '2em'
                }
            },

            colorAxis: {
                min: 0,
                minColor: '#FFFDE4',
                maxColor: '#005AA7'
            },

            mapNavigation: {
                enabled: true,
                buttonOptions: {
                    verticalAlign: 'bottom'
                }
            },

            plotOptions: {
                map: {
                    states: {
                        hover: {
                            color: '#EEDD66'
                        }
                    }
                }
            },

            series: [{
                data,
                name: '서울특별시',
                dataLabels: {
                    enabled: true,
                    format: '{point.properties.name}',
                    backgroundColor: 'rgba(255,255,255,0.7)',
                    borderRadius: 5,
                    padding: 3,
                    style: {
                        textOutline: 'none',
                        fontSize: '1.2em'
                    }
                }
            }],

            credits: {
                enabled: false
            },

            drilldown: {
                activeDataLabelStyle: {
                    color: '#0D211D',
                    textDecoration: 'none',
                }
            }
        });

    })();


</script>

</html>